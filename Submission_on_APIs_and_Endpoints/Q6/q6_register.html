<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Q6 Registration</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>body{font-family: Arial; padding:20px} form{max-width:400px}</style>
</head>
<body>
  <h1>Register</h1>
  <form id="reg">
    <div><label>Name<br/><input name="name" required /></label></div>
    <div><label>Email<br/><input name="email" type="email" required /></label></div>
    <div style="margin-top:8px"><button type="submit">Register</button></div>
    <div id="msg" style="margin-top:12px;color:green"></div>
  </form>

<script>
const base = 'http://localhost:3008/users';
const form = document.getElementById('reg');
const msg = document.getElementById('msg');

form.addEventListener('submit', function(e){
  e.preventDefault();
  msg.style.color = 'green';
  msg.textContent = 'Checking...';
  const fd = new FormData(form);
  const name = fd.get('name').trim();
  const email = fd.get('email').trim();

  // Check duplicate
  axios.get(base + '?email=' + encodeURIComponent(email))
    .then(res => {
      if(res.data && res.data.length){
        msg.style.color = 'red';
        msg.textContent = 'Email already registered.';
      } else {
        // Not exists -> POST
        axios.post(base, { name, email })
          .then(r => {
            msg.style.color = 'green';
            msg.textContent = 'Registered successfully!';
            form.reset();
          })
          .catch(err => {
            msg.style.color = 'red';
            msg.textContent = 'Failed to register.';
            console.error(err);
          });
      }
    })
    .catch(err => {
      msg.style.color = 'red';
      msg.textContent = 'Failed to check email.';
      console.error(err);
    });
});
</script>
</body>
</html>
