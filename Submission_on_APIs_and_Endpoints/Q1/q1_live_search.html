<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Q1 Live Search</title>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <style>
    body{font-family: Arial; padding:20px}
    .product{display:flex; gap:12px; align-items:center; padding:8px; border-bottom:1px solid #eee}
    .product img{width:60px; height:60px; object-fit:cover}
    .loading{display:none; margin-top:8px}
    .no-results{color:#999; margin-top:8px}
  </style>
</head>
<body>
  <h1>Live Product Search</h1>
  <input id="search" placeholder="Search products..." autocomplete="off" style="width:300px; padding:8px" />
  <div class="loading" id="loading">Loading…</div>
  <div id="results" style="margin-top:12px"></div>

<script>
$(function(){
  const $search = $('#search');
  const $results = $('#results');
  const $loading = $('#loading');
  let timer = null;

  function renderProducts(items){
    $results.empty();
    if(!items.length){
      $results.append('<div class="no-results">No products found</div>');
      return;
    }
    items.forEach(p => {
      const html = `<div class="product">
        <img src="${p.image}" alt="${p.name}" />
        <div>
          <div><strong>${p.name}</strong></div>
          <div>₹${p.price}</div>
        </div>
      </div>`;
      $results.append(html);
    });
  }

  function doSearch(q){
    $loading.show();
    $.ajax({
      url: 'http://localhost:3001/products',
      data: { q: q },
      method: 'GET',
      success: function(data){
        renderProducts(data);
      },
      error: function(){
        $results.html('<div class="no-results">Failed to load results</div>');
      },
      complete: function(){
        $loading.hide();
      }
    });
  }

  $search.on('input', function(){
    const q = $(this).val().trim();
    // debounce 250ms
    clearTimeout(timer);
    timer = setTimeout(() => {
      doSearch(q);
    }, 250);
  });

  // initial load - show all products
  doSearch('');
});
</script>
</body>
</html>
